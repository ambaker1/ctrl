\documentclass{article}

% Input packages & formatting
\input{template/packages}
\input{template/formatting}
\input{template/version}
\renewcommand{\cleartooddpage}[1][]{\ignorespaces} % single side
\newcommand{\caret}{$^\wedge$}

% Other macros
\renewcommand{\^}[1]{\textsuperscript{#1}}
\renewcommand{\_}[1]{\textsubscript{#1}}

\title{\Huge Tcl Variable Utilities\\\small Version \version}
\author{Alex Baker\\\small\url{https://github.com/ambaker1/vutil}}
\date{\small\today}
\begin{document}
\maketitle
\begin{abstract}
\begin{center}
This package provides various utilities for working with variables in Tcl.
\end{center}
\end{abstract}
\clearpage
\section{Printing Variables to Screen} 
The \cmdlink{pvar} command is a short-hand function for printing the name and values of Tcl variables.
\begin{syntax}
\command{pvar} \$name1 \$name2 …
\end{syntax}
\begin{args}
\$name1 \$name2 … & Name(s) of variables to print
\end{args}

\begin{example}{Printing variables to screen}
\begin{lstlisting}
set a 5
set b 7
set c(1) 5
set c(2) 6
pvar a b c
\end{lstlisting}
\tcblower
\begin{lstlisting}
a = 5
b = 7
c(1) = 5
c(2) = 6
\end{lstlisting}
\end{example}
\clearpage
\section{Initializing Local Namespace Variables}
The command \cmdlink{local} is the counterpart to the Tcl \textit{global} command, and creates local variables linked to variables in the current namespace, by simply calling the Tcl \textit{variable} command multiple times.
\begin{syntax}
\command{local} \$name1 \$name2 …
\end{syntax}
\begin{args}
\$name1 \$name2 … & Name(s) of variables to initialize
\end{args}
\begin{example}{Access namespace variables in a procedure}
\begin{lstlisting}
# Define global variables
global a b c
set a 1
set b 2
set c 3
namespace eval ::foo {
    # Define local variables
    local a b c
    set a 4
    set b 5
    set c 6
}
proc ::foo::bar1 {} {
    # Access global variables
    global a b c
    list $a $b $c
}
proc ::foo::bar2 {} {
    # Access local variables
    local a b c
    list $a $b $c
}
puts [::foo::bar1]; # global a b c
puts [::foo::bar2]; # local a b c
\end{lstlisting}
\tcblower
\begin{lstlisting}
1 2 3
4 5 6
\end{lstlisting}
\end{example}

\clearpage

\section{Default Values}
The command \cmdlink{default} assigns values to variables if they do not exist.

\begin{syntax}
\command{default} \$varName \$value
\end{syntax}
\begin{args}
\$varName & Name of variable to set \\
\$value & Default value for variable
\end{args}

The example below shows how default values are only applied if the variable does not exist.

\begin{example}{Variable defaults}
\begin{lstlisting}
set a 5
default a 7
puts $a
unset a
default a 7
puts $a
\end{lstlisting}
\tcblower
\begin{lstlisting}
5
7
\end{lstlisting}
\end{example}
\clearpage
\section{Variable Locks}
The command \cmdlink{lock} uses Tcl variable traces to make a read-only variable.

\begin{syntax}
\command{lock} \$varName <\$value>
\end{syntax}
\begin{args}
\$varName & Variable name to lock. \\
\$value & Value to lock variable at. Default self-locks (uses current value).
\end{args}

The command \cmdlink{unlock} unlocks previously locked variables so that they can be modified again.

\begin{syntax}
\command{unlock} \$name1 \$name2 …
\end{syntax}
\begin{args}
\$name1 \$name2 … & Variables to unlock.
\end{args}

\begin{example}{Variable locks}
\begin{lstlisting}
lock a 5
set a 7
puts $a
unlock a
set a 7
puts $a
\end{lstlisting}
\tcblower
\begin{lstlisting}
5
7
\end{lstlisting}
\end{example}

\clearpage

\section{Variable-Object Ties}
As of Tcl version 8.6, there is no garbage collection for Tcl objects, they have to be removed manually with the ``destroy'' method. 
The command \cmdlink{tie} is a solution for this problem, using variable traces to destroy the corresponding object when the variable is unset or modified. 
Tie is separate from lock; a tie will override a lock, and a lock will override a tie.
\begin{syntax}
\command{tie} \$varName <\$object>
\end{syntax}
\begin{args}
\$varName & Variable name to tie to object. \\
\$object & Object to tie variable to. Default self-ties (uses current value).
\end{args}

In similar fashion to \cmdlink{unlock}, tied variables can be untied with the command \cmdlink{untie}.

\begin{syntax}
\command{untie} \$name1 \$name2 …
\end{syntax}
\begin{args}
\$name1 \$name2 … & Variables to untie.
\end{args}

\begin{example}{Variable-object ties}
\begin{lstlisting}
oo::class create foo {
    method hi {} {
        puts hi
    }
}
tie a [foo create bar]
set b $a; # alias variable
unset a; # triggers ``destroy''
$b hi; # throws error
\end{lstlisting}
\tcblower
\begin{lstlisting}
invalid command name "::bar"
\end{lstlisting}
\end{example}
\end{document}
